# 恋爱翻译官 Web 端 - 启动指南

本文档提供详细的项目启动和部署说明。

## 一、环境准备

### 1.1 安装 Node.js

前往 [Node.js 官网](https://nodejs.org/) 下载并安装 Node.js 18 或更高版本。

验证安装:

```bash
node --version  # 应该显示 v18.x.x 或更高
npm --version   # 应该显示 9.x.x 或更高
```

### 1.2 安装包管理器 (可选)

推荐使用 pnpm 以获得更快的安装速度:

```bash
npm install -g pnpm
```

## 二、项目初始化

### 2.1 克隆代码

```bash
cd career_helper/frontend
```

### 2.2 安装依赖

使用 npm:

```bash
npm install
```

或使用 pnpm:

```bash
pnpm install
```

安装时间约 1-3 分钟,取决于网络速度。

### 2.3 配置环境变量

**开发环境**:

创建 `.env.local` 文件:

```env
# API 服务器地址
NEXT_PUBLIC_API_BASE_URL=https://local.chathandy.com

# 应用版本
NEXT_PUBLIC_APP_VERSION=1.0.0

# 环境标识
NEXT_PUBLIC_APP_ENV=development
```

**生产环境**:

创建 `.env.production` 文件:

```env
# API 服务器地址 (修改为实际生产环境地址)
NEXT_PUBLIC_API_BASE_URL=https://api.chathandy.com

# 应用版本
NEXT_PUBLIC_APP_VERSION=1.0.0

# 环境标识
NEXT_PUBLIC_APP_ENV=production
```

> **重要**: 请根据实际的后端服务器地址修改 `NEXT_PUBLIC_API_BASE_URL`

## 三、启动开发服务器

### 3.1 启动命令

```bash
npm run dev
```

或

```bash
pnpm dev
```

### 3.2 访问应用

启动成功后,在浏览器中访问:

```
http://localhost:3000
```

你应该会看到登录页面。

### 3.3 开发环境登录

在开发环境下,可以使用魔法验证码快速登录:

1. 输入任意 11 位手机号 (例如: 13800138000)
2. 点击"发送验证码"
3. 输入验证码: `1234`
4. 点击"登录"

## 四、构建和部署

### 4.1 构建生产版本

```bash
npm run build
```

构建完成后会生成 `.next` 目录,包含优化后的生产代码。

### 4.2 本地预览生产版本

```bash
npm run start
```

访问 `http://localhost:3000` 查看生产版本。

### 4.3 部署到 Vercel (推荐)

Vercel 是 Next.js 官方推荐的部署平台。

**步骤**:

1. 在 [Vercel](https://vercel.com) 注册账号
2. 连接你的 Git 仓库
3. 导入项目
4. 配置环境变量:
   - `NEXT_PUBLIC_API_BASE_URL`: 生产环境 API 地址
   - `NEXT_PUBLIC_APP_VERSION`: 版本号
   - `NEXT_PUBLIC_APP_ENV`: `production`
5. 点击 Deploy

每次推送代码到主分支都会自动部署。

### 4.4 部署到自有服务器

**使用 PM2 管理进程**:

1. 安装 PM2:

```bash
npm install -g pm2
```

2. 构建项目:

```bash
npm run build
```

3. 启动应用:

```bash
pm2 start npm --name "chathandy-web" -- start
```

4. 保存 PM2 配置:

```bash
pm2 save
pm2 startup
```

**使用 Nginx 反向代理**:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 4.5 部署到 Docker

创建 `Dockerfile`:

```dockerfile
FROM node:18-alpine AS base

# 安装依赖
FROM base AS deps
WORKDIR /app
COPY package.json pnpm-lock.yaml* package-lock.json* ./
RUN npm install

# 构建应用
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# 运行应用
FROM base AS runner
WORKDIR /app
ENV NODE_ENV production
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

构建和运行:

```bash
docker build -t chathandy-web .
docker run -p 3000:3000 -e NEXT_PUBLIC_API_BASE_URL=https://api.chathandy.com chathandy-web
```

## 五、开发指南

### 5.1 开发工具推荐

- **VS Code**: 推荐的代码编辑器
- **插件**:
  - ESLint
  - Prettier
  - Tailwind CSS IntelliSense
  - TypeScript Vue Plugin (Volar)

### 5.2 代码规范

项目使用 TypeScript 严格模式,请遵循以下规范:

- 使用 TypeScript 类型注解
- 遵循 ESLint 规则
- 使用 Prettier 格式化代码
- 组件名使用 PascalCase
- 文件名使用 kebab-case 或 camelCase

### 5.3 Git 工作流

```bash
# 创建功能分支
git checkout -b feature/your-feature-name

# 提交代码
git add .
git commit -m "feat: 添加某某功能"

# 推送到远程
git push origin feature/your-feature-name

# 创建 Pull Request
```

提交信息规范:

- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 重构代码
- `test`: 测试相关
- `chore`: 构建/工具相关

## 六、常见问题

### 6.1 依赖安装失败

**问题**: `npm install` 报错

**解决**:

1. 清除缓存:

```bash
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

2. 切换 npm 镜像源:

```bash
npm config set registry https://registry.npmmirror.com
```

### 6.2 端口被占用

**问题**: `Error: listen EADDRINUSE: address already in use :::3000`

**解决**:

修改端口:

```bash
PORT=3001 npm run dev
```

或关闭占用 3000 端口的进程。

### 6.3 API 请求失败

**问题**: 页面显示 "加载失败" 或 API 请求 404

**解决**:

1. 检查 `.env.local` 中的 `NEXT_PUBLIC_API_BASE_URL` 是否正确
2. 确认后端服务已启动
3. 检查浏览器开发者工具 Network 标签查看具体错误
4. 检查后端 CORS 配置是否允许前端域名

### 6.4 图片上传失败

**问题**: 上传头像或聊天图片时失败

**解决**:

1. 检查文件大小是否超过 10MB
2. 检查文件格式是否为图片 (jpg, png, gif, webp)
3. 检查后端上传接口是否正常
4. 检查浏览器控制台错误信息

### 6.5 登录后跳转失败

**问题**: 登录成功但页面不跳转

**解决**:

1. 检查浏览器控制台是否有错误
2. 清除浏览器缓存和 localStorage:

```javascript
// 在浏览器控制台执行
localStorage.clear();
location.reload();
```

3. 检查用户性别是否已设置

### 6.6 生产环境构建失败

**问题**: `npm run build` 报错

**解决**:

1. 检查 TypeScript 类型错误:

```bash
npm run type-check
```

2. 检查 ESLint 错误:

```bash
npm run lint
```

3. 逐个修复报错

## 七、性能优化

### 7.1 图片优化

- 使用 Next.js Image 组件自动优化
- 上传前客户端压缩
- 使用 WebP 格式

### 7.2 代码分割

- 使用动态导入 `import()` 按需加载组件
- Next.js 自动按页面分割代码

### 7.3 缓存策略

- API 响应缓存 (30 分钟)
- 静态资源缓存 (1 年)
- Service Worker 离线缓存 (可选)

## 八、监控和日志

### 8.1 错误监控

推荐集成 Sentry:

```bash
npm install @sentry/nextjs
```

### 8.2 性能监控

使用 Next.js Analytics:

```bash
npm install @vercel/analytics
```

### 8.3 日志记录

在 `src/services/api/client.ts` 中添加请求日志:

```typescript
apiClient.interceptors.request.use((config) => {
  console.log('[API Request]', config.method?.toUpperCase(), config.url);
  return config;
});
```

## 九、安全建议

1. **环境变量**: 不要在代码中硬编码敏感信息
2. **Token 存储**: 使用 httpOnly Cookie 或安全的 localStorage
3. **HTTPS**: 生产环境必须使用 HTTPS
4. **CSP**: 配置 Content Security Policy
5. **依赖更新**: 定期更新依赖包修复安全漏洞

```bash
npm audit
npm audit fix
```

## 十、联系支持

如有问题,请联系开发团队或提交 Issue。

---

**最后更新**: 2024-01-04
**版本**: 1.0.0
